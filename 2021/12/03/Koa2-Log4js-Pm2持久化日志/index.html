<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Koa2+Log4js+PM2æŒä¹…åŒ–æ—¥å¿—åŠä½¿ç”¨é—®é¢˜ | ä¸å¤§é“­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="æœ€è¿‘ä¸€ç›´åœ¨å¼€å‘nodeç›¸å…³çš„é¡¹ç›®ï¼Œåšäº†ä¸€æ®µæ—¶é—´äº†ï¼Œé¡¹ç›®å·²ç»è®©å¤§å®¶æ­£å¸¸ä½¿ç”¨ä¸Šäº†ï¼Œä½†æ˜¯æ—¥å¿—ç³»ç»Ÿä¸€ç›´æ²¡æœ‰æ¥å…¥ï¼Œæ‰€ä»¥ç»è¿‡æŸ¥é˜…ä¸å¹³è¡¡å¤æ‚åº¦ï¼Œå†³å®šä½¿ç”¨koa-log4è¿›è¡Œæ—¥å¿—çš„ç®¡ç†ã€‚å…³äº log4js çš„ä»‹ç»åœ¨è¿™é‡Œå°±ä¸å¤šå™è¿°äº†ï¼Œæƒ³äº†è§£è¯·ç‚¹å‡»â€ƒ log4jsè¯¦ç»†ä»‹ç» è¯´åˆ°æ•°æ®æŒä¹…åŒ–ï¼Œæœ€æ™®éçš„æ— éå°±ä¸¤ç§æ–¹å¼:  æ–‡ä»¶å­˜å‚¨(å¯¼å‡º.logæ–‡ä»¶) æ•°æ®åº“å­˜å‚¨(åŸºç¡€çš„å¢åŠ åŠŸèƒ½)  æœ¬æ–‡å°†ä»¥log4jsä¸ºä¸»çº¿ï¼Œä»¥æ–‡ä»¶å­˜å‚¨å½¢">
<meta property="og:type" content="article">
<meta property="og:title" content="Koa2+Log4js+PM2æŒä¹…åŒ–æ—¥å¿—åŠä½¿ç”¨é—®é¢˜">
<meta property="og:url" content="http://example.com/2021/12/03/Koa2-Log4js-Pm2%E6%8C%81%E4%B9%85%E5%8C%96%E6%97%A5%E5%BF%97/index.html">
<meta property="og:site_name" content="ä¸å¤§é“­">
<meta property="og:description" content="æœ€è¿‘ä¸€ç›´åœ¨å¼€å‘nodeç›¸å…³çš„é¡¹ç›®ï¼Œåšäº†ä¸€æ®µæ—¶é—´äº†ï¼Œé¡¹ç›®å·²ç»è®©å¤§å®¶æ­£å¸¸ä½¿ç”¨ä¸Šäº†ï¼Œä½†æ˜¯æ—¥å¿—ç³»ç»Ÿä¸€ç›´æ²¡æœ‰æ¥å…¥ï¼Œæ‰€ä»¥ç»è¿‡æŸ¥é˜…ä¸å¹³è¡¡å¤æ‚åº¦ï¼Œå†³å®šä½¿ç”¨koa-log4è¿›è¡Œæ—¥å¿—çš„ç®¡ç†ã€‚å…³äº log4js çš„ä»‹ç»åœ¨è¿™é‡Œå°±ä¸å¤šå™è¿°äº†ï¼Œæƒ³äº†è§£è¯·ç‚¹å‡»â€ƒ log4jsè¯¦ç»†ä»‹ç» è¯´åˆ°æ•°æ®æŒä¹…åŒ–ï¼Œæœ€æ™®éçš„æ— éå°±ä¸¤ç§æ–¹å¼:  æ–‡ä»¶å­˜å‚¨(å¯¼å‡º.logæ–‡ä»¶) æ•°æ®åº“å­˜å‚¨(åŸºç¡€çš„å¢åŠ åŠŸèƒ½)  æœ¬æ–‡å°†ä»¥log4jsä¸ºä¸»çº¿ï¼Œä»¥æ–‡ä»¶å­˜å‚¨å½¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-03T08:26:41.000Z">
<meta property="article:modified_time" content="2022-06-17T09:05:49.268Z">
<meta property="article:author" content="DingMing">
<meta property="article:tag" content="node">
<meta property="article:tag" content="æ—¥å¿—">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ä¸å¤§é“­" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/plugin/bganimation/bg.css">

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" rel="stylesheet" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
  <canvas id="Mycanvas"></canvas>
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="http://yxt-guanwang.oss-cn-beijing.aliyuncs.com/images/www/avatars0.jpg">
    <h2 class="author">DingMing</h2>
    <h3 class="description">ä¸å¤§é“­çš„ä¸ªäººç©ºé—´ï¼Œç”¨æ¥åˆ†äº«ä¸€äº›å‰ç«¯å°æŠ€å·§ï¼Œé»˜é»˜æˆé•¿å§ï¼Œå“ˆå“ˆ</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>44</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>21</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>26</strong><br>æ ‡ç­¾</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/about" title="About">
            <li>å…³äº</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
          <a href="/cv" title="Cv">
            <li>ç®€å†</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-Koa2-Log4js-Pm2æŒä¹…åŒ–æ—¥å¿—" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/12/03/Koa2-Log4js-Pm2%E6%8C%81%E4%B9%85%E5%8C%96%E6%97%A5%E5%BF%97/" class="article-date">
  <time class="post-time" datetime="2021-12-03T08:26:41.000Z" itemprop="datePublished">
    <span class="post-month">12æœˆ</span><br/>
    <span class="post-day">03</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Koa2+Log4js+PM2æŒä¹…åŒ–æ—¥å¿—åŠä½¿ç”¨é—®é¢˜
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/node/">node</a>,<a class="article-category-link" href="/categories/node/%E6%97%A5%E5%BF%97/">æ—¥å¿—</a>
  </div>

          
              <!-- <script>
  const pathname = window.location.pathname;
  console.log('ğŸš€ ', pathname)
</script> -->


  &nbsp; | &nbsp;
  <div class="view-box">
    <span class="Koa2+Log4js+PM2æŒä¹…åŒ–æ—¥å¿—åŠä½¿ç”¨é—®é¢˜" id="busuanzi_container_page_pv"  data-flag-title="Koa2+Log4js+PM2æŒä¹…åŒ–æ—¥å¿—åŠä½¿ç”¨é—®é¢˜">
      &nbsp;é˜…è¯»æ¬¡æ•°<span id="busuanzi_value_page_pv"></span>
    </span>
  </div>

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœ€è¿‘ä¸€ç›´åœ¨å¼€å‘nodeç›¸å…³çš„é¡¹ç›®ï¼Œåšäº†ä¸€æ®µæ—¶é—´äº†ï¼Œé¡¹ç›®å·²ç»è®©å¤§å®¶æ­£å¸¸ä½¿ç”¨ä¸Šäº†ï¼Œä½†æ˜¯æ—¥å¿—ç³»ç»Ÿä¸€ç›´æ²¡æœ‰æ¥å…¥ï¼Œæ‰€ä»¥ç»è¿‡æŸ¥é˜…ä¸å¹³è¡¡å¤æ‚åº¦ï¼Œå†³å®šä½¿ç”¨koa-log4è¿›è¡Œæ—¥å¿—çš„ç®¡ç†ã€‚å…³äº log4js çš„ä»‹ç»åœ¨è¿™é‡Œå°±ä¸å¤šå™è¿°äº†ï¼Œæƒ³äº†è§£è¯·ç‚¹å‡»â€ƒ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/log4js">log4jsè¯¦ç»†ä»‹ç»</a></p>
<p>è¯´åˆ°æ•°æ®æŒä¹…åŒ–ï¼Œæœ€æ™®éçš„æ— éå°±ä¸¤ç§æ–¹å¼:</p>
<ul>
<li>æ–‡ä»¶å­˜å‚¨(å¯¼å‡º.logæ–‡ä»¶)</li>
<li>æ•°æ®åº“å­˜å‚¨(åŸºç¡€çš„å¢åŠ åŠŸèƒ½)</li>
</ul>
<p>æœ¬æ–‡å°†ä»¥log4jsä¸ºä¸»çº¿ï¼Œä»¥æ–‡ä»¶å­˜å‚¨å½¢å¼ å¹¶ä¸”ä¸è¿ç»´é…åˆ é€šè¿‡logstashä¸Šä¼ ELKåˆ°KibanaæŸ¥è¯¢çš„æ–¹å¼å®ç°çš„ã€‚</p>
<h2 id="æŒä¹…åŒ–è‡³æ–‡ä»¶"><a href="#æŒä¹…åŒ–è‡³æ–‡ä»¶" class="headerlink" title="æŒä¹…åŒ–è‡³æ–‡ä»¶"></a>æŒä¹…åŒ–è‡³æ–‡ä»¶</h2><p>log4js è¾“å…¥æ—¥å¿—åˆ°æ–‡ä»¶æœ‰ä¸¤ç§å½¢å¼:</p>
<ul>
<li>file è¾“å‡ºåˆ°æ–‡ä»¶, æŒ‡å®šå•ä¸€æ–‡ä»¶åç§°, ä¾‹å¦‚: default.log</li>
<li>dateFile è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œæ–‡ä»¶å¯ä»¥æŒ‰æ—¥æœŸæ¨¡å¼æ»šåŠ¨ï¼Œä¾‹å¦‚: 2021-12-03.log</li>
</ul>
<p>ç›´æ¥ä¸Šä»£ç :</p>
<span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// log4js.js</span><br><span class="line">import log4js from &#x27;koa-log4&#x27;</span><br><span class="line">import path from &#x27;path&#x27; </span><br><span class="line"></span><br><span class="line">log4js.configure(&#123;</span><br><span class="line">    appenders: &#123;</span><br><span class="line">        error: &#123;</span><br><span class="line">            type: &#x27;file&#x27;,           //æ—¥å¿—ç±»å‹</span><br><span class="line">            category: &#x27;errLogger&#x27;,    //æ—¥å¿—åç§°</span><br><span class="line">            filename: path.join(&#x27;logs/&#x27;, &#x27;error/error.log&#x27;), //æ—¥å¿—è¾“å‡ºä½ç½®ï¼Œå½“ç›®å½•æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</span><br><span class="line">            maxLogSize: 104800, // æ–‡ä»¶æœ€å¤§å­˜å‚¨ç©ºé—´</span><br><span class="line">            backups: 100  //å½“æ–‡ä»¶å†…å®¹è¶…è¿‡æ–‡ä»¶å­˜å‚¨ç©ºé—´æ—¶ï¼Œå¤‡ä»½æ–‡ä»¶çš„æ•°é‡</span><br><span class="line">        &#125;,</span><br><span class="line">        response: &#123;</span><br><span class="line">            type: &#x27;dateFile&#x27;,</span><br><span class="line">            category: &#x27;resLogger&#x27;,</span><br><span class="line">            filename: path.join(&#x27;logs/&#x27;, &#x27;responses/&#x27;),</span><br><span class="line">            pattern: &#x27;yyyy-MM-dd.log&#x27;, //æ—¥å¿—è¾“å‡ºæ¨¡å¼</span><br><span class="line">            alwaysIncludePattern: true,</span><br><span class="line">            maxLogSize: 104800,</span><br><span class="line">            backups: 100</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    categories: &#123;</span><br><span class="line">        error: &#123;appenders: [&#x27;error&#x27;], level: &#x27;info&#x27;&#125;,</span><br><span class="line">        response: &#123;appenders: [&#x27;response&#x27;], level: &#x27;info&#x27;&#125;,</span><br><span class="line">        default: &#123; appenders: [&#x27;response&#x27;], level: &#x27;info&#x27;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    replaceConsole: true</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—é…ç½®æ–‡ä»¶æˆ‘ä»¬å·²ç»å®Œæˆï¼Œåœ¨è¿™é‡Œå®šä¹‰äº†ä¸¤ç§å½¢å¼çš„æ—¥å¿—ï¼Œåˆ†åˆ«æ˜¯ errLogger é”™è¯¯æ—¥å¿—, resLogger å“åº”æ—¥å¿—ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™ä¸¤ç§æ—¥å¿—è¿›è¡Œè‡ªå®šä¹‰æ ¼å¼åŒ–è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// log4js.js</span><br><span class="line"></span><br><span class="line">let logger = &#123;&#125;</span><br><span class="line"></span><br><span class="line">const formatError = (ctx, err) =&gt; &#123;</span><br><span class="line">    const &#123;method,url&#125; = ctx</span><br><span class="line">    let body = ctx.request.body</span><br><span class="line">    const user = ctx.state.user</span><br><span class="line">    return &#123;method, url,body,user, err&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  const formatRes = (ctx,costTime) =&gt; &#123;</span><br><span class="line">      const &#123;method,url,response:&#123;status,message,body:&#123;success&#125;&#125;,request:&#123;header:&#123;authorization&#125;&#125;&#125; = ctx</span><br><span class="line">    let body = ctx.request.body</span><br><span class="line">    const user = ctx.state.user</span><br><span class="line">    return &#123;method, url,user, body, costTime,authorization, response:&#123;status,message,body:&#123;success&#125;&#125;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let errorLogger = log4js.getLogger(&#x27;error&#x27;)</span><br><span class="line">let resLogger = log4js.getLogger(&#x27;response&#x27;)</span><br><span class="line"></span><br><span class="line">// å°è£…é”™è¯¯æ—¥å¿—</span><br><span class="line">logger.errLogger = (ctx, error) =&gt; &#123;</span><br><span class="line">    if(ctx &amp;&amp; error) &#123;</span><br><span class="line">        errorLogger.error(formatError(ctx, error))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å°è£…å“åº”æ—¥å¿—</span><br><span class="line">logger.resLogger = (ctx, resTime) =&gt; &#123;</span><br><span class="line">    if(ctx) &#123;</span><br><span class="line">        resLogger.info(formatRes(ctx, resTime))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default logger</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ—¥å¿—æ¨¡å‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//app.js</span><br><span class="line">import log4js from &#x27;./utils/log4js&#x27;</span><br><span class="line"></span><br><span class="line">// logger</span><br><span class="line">app.use(async (ctx, next) =&gt; &#123;</span><br><span class="line">  const start = new Date()</span><br><span class="line">  await next()</span><br><span class="line">  const ms = new Date() - start</span><br><span class="line">  console.log(`$&#123;ctx.method&#125; $&#123;ctx.url&#125; - $&#123;ms&#125;ms`)</span><br><span class="line">  log4js.resLogger(ctx, ms)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// error-handling</span><br><span class="line">app.on(&#x27;error&#x27;, (err, ctx) =&gt; &#123;</span><br><span class="line">  log4js.errLogger(ctx, err)</span><br><span class="line">  console.error(&#x27;server error&#x27;, err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬çš„è®¿é—®ä¿¡æ¯éƒ½å·²è¢«è¾“å‡ºåˆ°äº†é¡¹ç›® logs æ–‡ä»¶å¤¹ä¸‹é¢ã€‚</p>
<h2 id="é›†ç¾¤æ¨¡å¼PM2-Log4js-logå†™å…¥å¤±è´¥é—®é¢˜"><a href="#é›†ç¾¤æ¨¡å¼PM2-Log4js-logå†™å…¥å¤±è´¥é—®é¢˜" class="headerlink" title="é›†ç¾¤æ¨¡å¼PM2 Log4js logå†™å…¥å¤±è´¥é—®é¢˜"></a>é›†ç¾¤æ¨¡å¼PM2 Log4js logå†™å…¥å¤±è´¥é—®é¢˜</h2><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨PM2æŒä¹…åŒ–è¿›ç¨‹è¾“å‡ºæ—¥å¿—æ˜¯å®Œå…¨çš„ï¼Œä½†æ˜¯ä¸€æ—¦ä½¿ç”¨ é›†ç¾¤æ¨¡å¼(â€œinstancesâ€ : number)ä¸‹æ—¶ï¼Œå°±å‡ºç°å†™ä¸å…¥æ—¥å¿—çš„æƒ…å†µ</p>
<pre><code>ï¼ï¼ï¼ æ¯æ¬¡é‡å¯PM2æ—¶ï¼Œéœ€è¦å…ˆdeleteä»»åŠ¡ï¼Œç„¶åå†é‡æ–°å¯åŠ¨
</code></pre>
<p>æ­£å¸¸ç›´æ¥å¯åŠ¨ä¼šåœ¨é…ç½® log ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªyyyy-MM-dd-hh.logæ ¼å¼çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç”¨pm2å¯åŠ¨çš„æ—¶å€™å¹¶æ²¡æœ‰ç”Ÿæˆã€‚</p>
<p>log4js çš„è°ƒç”¨æ–¹æ³•ä¸ºrequire(â€˜log4jsâ€™).getLogger(),æ‰€ä»¥å°±ç›´æ¥åœ¨æºç ä¸­æ‰¾getLoggerï¼š </p>
<ol>
<li>é€šè¿‡package.jsonä¸­çš„mainæˆ‘ä»¬ç¡®å®šå®ƒçš„ä¸»å…¥å£æ–‡ä»¶ä¸º./lib/log4jsï¼› </li>
<li>æ‰¾åˆ°getLoggeræ–¹æ³•</li>
</ol>
<p>å…¶ä¸­æœ‰ä¸ªisMaster()æ–¹æ³•,åˆ¤æ–­æ˜¯å¦ä¸ºä¸»è¿›ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function isPM2Master() &#123;</span><br><span class="line">    return config.pm2 &amp;&amp; process.env[config.pm2InstanceVar] === &#x27;0&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isMaster() &#123;</span><br><span class="line">    return config.disableClustering || cluster.isMaster || isPM2Master()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°isPM2Masteræ˜¯é€šè¿‡ config ä¸­çš„pm2å‚æ•°å’Œpm2InstanceVaræ¥ç¡®å®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨log4jsçš„é…ç½®ä¸­å¢åŠ è¿™ä¸¤ä¸ªé…ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### !!!!!ä¿®æ­£</span><br></pre></td></tr></table></figure>
<p>pm2 install pm2-intercom</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//process-dev.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;buran-api-dev&quot;,</span><br><span class="line">      &quot;script&quot;: &quot;index.js&quot;,</span><br><span class="line">      &quot;watch&quot;: true,</span><br><span class="line">      &quot;cwd&quot;:&quot;./&quot;,</span><br><span class="line">      &quot;ignore_watch&quot; : [&quot;jobs/*&quot;,&quot;node_modules/*&quot;,&quot;public&quot;],</span><br><span class="line">      &quot;instances&quot; : 4, </span><br><span class="line">      &quot;instance_var&quot;: &quot;INSTANCE_ID&quot;,  !!è¿™é‡Œ!ï¼</span><br><span class="line">      &quot;exec_mode&quot; : &quot;cluster&quot;,</span><br><span class="line">      &quot;merge_logs&quot;: true,</span><br><span class="line">      &quot;autorestart&quot;: true,</span><br><span class="line">      &quot;log_date_format&quot;: &quot;YYYY-MM-DD HH:mm:ss&quot;,</span><br><span class="line">      &quot;env&quot;: &#123;</span><br><span class="line">        &quot;NODE_ENV&quot;: &quot;production&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//log4js.js</span><br><span class="line">log4js.configure(&#123;</span><br><span class="line">    pm2: true,</span><br><span class="line">    pm2InstanceVar: &quot;INSTANCE_ID&quot;, // ä¸pm2çš„instance_varå¯¹åº”</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±å®Œå…¨okäº†ã€‚ å‰©ä¸‹çš„å°±äº¤ç»™è¿ç»´åŒå­¦ï¼Œå‘Šè¯‰ä»–æ—¥å¿—ç”Ÿæˆçš„ç›®å½•ï¼Œä»–æ¥è¿›è¡Œç›‘å¬ä¸Šä¼ </p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="http://example.com/2021/12/03/Koa2-Log4js-Pm2%E6%8C%81%E4%B9%85%E5%8C%96%E6%97%A5%E5%BF%97/" data-id="cl61xf5hp000s19k6cpm52qrn" class="article-share-link">åˆ†äº«</a> -->
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%97%A5%E5%BF%97/" rel="tag">æ—¥å¿—</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/01/17/%E4%B8%89%E4%BA%9A%E4%B9%8B%E6%97%85/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          å¹´ç»ˆæ€»ç»“ä¹‹--ä¸‰äºšä¹‹æ—…
        
      </div>
    </a>
  
  
    <a href="/2021/10/22/UNPKG%E5%92%8COss%E8%BE%B9%E7%BC%98%E8%84%9A%E6%9C%AC%E7%9A%84%E7%AE%80%E8%BF%B0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">UNPKGå’ŒOssè¾¹ç¼˜è„šæœ¬çš„ç®€è¿°</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">ä¸å¤§é“­</h1>
    <h2 class="blog-subtitle">My Heart Will Go On</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/about" title="About">
            <li>å…³äº</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
          <a href="/cv" title="Cv">
            <li>ç®€å†</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="http://yxt-guanwang.oss-cn-beijing.aliyuncs.com/images/www/avatars0.jpg">
    <h2 class="author">DingMing</h2>
    <!-- <h3 class="description">ä¸å¤§é“­çš„ä¸ªäººç©ºé—´ï¼Œç”¨æ¥åˆ†äº«ä¸€äº›å‰ç«¯å°æŠ€å·§ï¼Œé»˜é»˜æˆé•¿å§ï¼Œå“ˆå“ˆ</h3> -->
    <div class="count-box">
      <a href="/archives"><div><strong>44</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>21</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>26</strong><br>æ ‡ç­¾</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="https://github.com/wohaofang" target="_blank" title="Github">
          Github
        </a>
      
        <a class="hvr-bounce-in" href="https://juejin.cn/user/923245497292375" target="_blank" title="æ˜é‡‘">
          æ˜é‡‘
        </a>
      
    </div>

    <div class="friend-link">
      <h2>å‹æƒ…é“¾æ¥</h2>
      
        <a class="hvr-bounce-in" href="http://github.com/ShanaMaid" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2021 - 2022 DingMing<br>
      ç”±<a href="http://hexo.io/" target="_blank">Hexo</a>å¼ºåŠ›é©±åŠ¨ | 
      ä¸»é¢˜-<a target="_blank" rel="noopener" href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>

  
    <!-- ä¸è’œå­ç»Ÿè®¡ -->
    <div class="outer " id="footer-info">
    <span id="busuanzi_container_site_pv">
            æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
    </span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv" style='display:none'>
            æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
    </span>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  </div>

</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  
<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">

  
<script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>




  
<link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">

  
<script src="/plugin/galmenu/GalMenu.js"></script>

  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">é¦–é¡µ</a>
          
            <a href="/tags" title="" class="menuItem">æ ‡ç­¾</a>
          
            <a href="/categories" title="" class="menuItem">åˆ†ç±»</a>
          
            <a href="/archives" title="" class="menuItem">å½’æ¡£</a>
          
            <a href="/cv" title="" class="menuItem">ç®€å†</a>
          
            <a href="/about" title="" class="menuItem">å…³äº</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
</section>

<script src="/js/script.js"></script>






  </div>
</body>
</html>